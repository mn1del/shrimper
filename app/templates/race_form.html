{% extends 'base.html' %}

{% block content %}
<h1>Create New Race</h1>
<form method="post">
  <div class="mb-3">
    <label class="form-label">Series</label>
    <select class="form-select" name="series_id" id="series_id" required>
      <option value="" {% if not selected_series %}selected{% endif %}>Select Series or create new</option>
      {% for s in series_list %}
        <option value="{{ s.series_id }}" {% if selected_series == s.series_id %}selected{% endif %}>{{ s.name }}</option>
      {% endfor %}
      <option value="__new__" {% if selected_series == '__new__' %}selected{% endif %}>Create New Series</option>
    </select>
  </div>

  <div id="new-series-fields" style="display:none;">
    <h2>New Series Details</h2>
    <div class="mb-3">
      <label class="form-label">Series Name</label>
      <input type="text" class="form-control" name="new_series_name">
    </div>
  </div>

  <h2>Race Details</h2>
  <div class="mb-3">
    <label class="form-label">Race Date</label>
    <input type="date" class="form-control" name="race_date" required>
  </div>
  <div class="mb-3">
    <label class="form-label">Race Time</label>
    <input type="text" class="form-control" name="race_time" pattern="^\d{2}:\d{2}:\d{2}$" placeholder="hh:mm:ss">
  </div>
  <button class="btn btn-primary">Save</button>
</form>

<script>
  const seriesSelect = document.getElementById('series_id');
  const newSeries = document.getElementById('new-series-fields');
  function toggleSeries() {
    if (seriesSelect.value === '__new__') {
      newSeries.style.display = 'block';
    } else {
      newSeries.style.display = 'none';
    }
  }
  seriesSelect.addEventListener('change', toggleSeries);
  toggleSeries();
</script>
{% endblock %}
